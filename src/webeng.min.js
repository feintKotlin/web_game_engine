"use strict";var feint;(function(feint){var Transform=function(){function Transform(){}return Transform}();feint.Transform=Transform;var Position=function(){function Position(x,y){this._x=0;this._y=0;this._x=x;this._y=y}Object.defineProperty(Position.prototype,"X",{get:function(){return this._x},set:function(x){this._x=x},enumerable:true,configurable:true});Object.defineProperty(Position.prototype,"Y",{get:function(){return this._y},set:function(y){this._y=y},enumerable:true,configurable:true});return Position}();feint.Position=Position;var Size=function(){function Size(width,height){this._width=width;this._height=height}Object.defineProperty(Size.prototype,"Width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(Size.prototype,"Height",{get:function(){return this._height},enumerable:true,configurable:true});return Size}();feint.Size=Size;var Rect=function(){function Rect(x,y,width,height){this._x=x;this._y=y;this._width=width;this._height=height}Object.defineProperty(Rect.prototype,"X",{get:function(){return this._x},set:function(x){this._x=x},enumerable:true,configurable:true});Object.defineProperty(Rect.prototype,"Y",{get:function(){return this._y},set:function(y){this._y=y},enumerable:true,configurable:true});Object.defineProperty(Rect.prototype,"Width",{get:function(){return this._width},enumerable:true,configurable:true});Object.defineProperty(Rect.prototype,"Height",{get:function(){return this._height},enumerable:true,configurable:true});return Rect}();feint.Rect=Rect})(feint||(feint={}));"use strict";var feint;(function(feint){function isInArea(pos,rect){return pos.X>=rect.X&&pos.X<=rect.X+rect.Width&&pos.Y>=rect.Y&&pos.Y<=rect.Y+rect.Height}feint.isInArea=isInArea;var Color;(function(Color){function rgb(r,g,b){return"rgb("+Math.floor(r)+","+Math.floor(g)+","+Math.floor(b)+")"}Color.rgb=rgb;function rgba(r,g,b,a){return"rgba("+Math.floor(r)+","+Math.floor(g)+","+Math.floor(b)+","+a+")"}Color.rgba=rgba;function isColor(color){return color.indexOf("rgb")==0||color.indexOf("#")==0}Color.isColor=isColor})(Color=feint.Color||(feint.Color={}));var Map=function(){function Map(){this._capacity=16;this._pairList=[];for(var i=0;i<this._capacity;++i){this._pairList.push([])}}Map.prototype.put=function(key,value){this._pairList[this.hashcode(key)].push(value)};Map.prototype.get=function(key){var hash=this.hashcode(key);var resutlList=this._pairList[hash];if(resutlList.length==1)return resutlList[0];else if(resutlList.length>1){var resultIndex=0;for(var i=0;i<resutlList.length;++i){if(resutlList[i].Name==key){resultIndex=i;break}}return resutlList[resultIndex]}else{return null}};Map.prototype.hashcode=function(key){var hash=0;for(var i=0;i<key.length;++i){hash+=Number(key.charAt(i))<<i}return hash%this._capacity};return Map}();feint.Map=Map})(feint||(feint={}));"use strict";var feint;(function(feint){var Canvas=function(){function Canvas(canvas){this._mouseDownEvent=function(event){};this._canvas=canvas;this._context=canvas.getContext("2d")}Canvas.prototype.resize=function(size){this._canvas.width=size.Width;this._canvas.height=size.Height};Object.defineProperty(Canvas.prototype,"Canvas",{get:function(){return this._canvas},enumerable:true,configurable:true});Object.defineProperty(Canvas.prototype,"Width",{get:function(){return this._canvas.width},set:function(width){this._canvas.width=width},enumerable:true,configurable:true});Object.defineProperty(Canvas.prototype,"Height",{get:function(){return this._canvas.height},set:function(height){this._canvas.height=height},enumerable:true,configurable:true});Object.defineProperty(Canvas.prototype,"FillStyle",{set:function(style){this._context.fillStyle=style},enumerable:true,configurable:true});Object.defineProperty(Canvas.prototype,"MouseDownEvent",{set:function(event){this._mouseDownEvent=event},enumerable:true,configurable:true});Canvas.prototype.fillRect=function(rect){this._context.fillRect(rect.X,rect.Y,rect.Width,rect.Height)};Canvas.prototype.strokeRect=function(rect){this._context.strokeRect(rect.X,rect.Y,rect.Width,rect.Height)};Object.defineProperty(Canvas.prototype,"StrokeStyle",{set:function(style){this._context.strokeStyle=style},enumerable:true,configurable:true});Canvas.prototype.drawImage=function(src,size,rederable){var _this=this;var img=new Image(size.Width,size.Height);img.src=src;img.onload=function(){_this._context.drawImage(img,0,0,size.Width,size.Height);rederable.State=feint.RenderState.Rendered}};Canvas.prototype.drawImageWithCanvas=function(canvas,rederable){this._context.drawImage(canvas,0,0);rederable.State=feint.RenderState.Rendered};Canvas.prototype.clear=function(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height)};Canvas.prototype.openListener=function(){var _this=this;this._canvas.onmousedown=function(event){_this._mouseDownEvent(event)}};return Canvas}();feint.Canvas=Canvas})(feint||(feint={}));"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var feint;(function(feint){var Render=function(){function Render(scene){this._scene=scene}Render.prototype.render=function(){this._scene.Canvas.clear();if(this._scene.State==RenderState.NoRender)this.renderScene();this.renderObjects();if(this._scene.State==RenderState.Rendered)this._scene.State=RenderState.NoRender};Render.prototype.renderObjects=function(){var _this=this;var gameObjects=this._scene.GameObjects;gameObjects.forEach(function(gameObject){_this._scene.Canvas.FillStyle="#ffffff";_this.renderObject(gameObject)})};Render.prototype.renderObject=function(gameObject){this._scene.Canvas.StrokeStyle="#00ff00";this._scene.Canvas.strokeRect(gameObject.Bounding);gameObject.draw(this._scene.Canvas)};Render.prototype.renderScene=function(){this._scene.State=RenderState.Rendering;if(feint.Color.isColor(this._scene.BackGround)){this._scene.Canvas.FillStyle=this._scene.BackGround;this._scene.Canvas.fillRect(new feint.Rect(0,0,this._scene.Size.Width,this._scene.Size.Height));this._scene.State=RenderState.Rendered}else{this._scene.Canvas.drawImageWithCanvas(this._scene.ResourceManager.find(this._scene.Name).Canvas.Canvas,this._scene)}};return Render}();feint.Render=Render;var RenderState;(function(RenderState){RenderState[RenderState["NoRender"]=10]="NoRender";RenderState[RenderState["Rendering"]=20]="Rendering";RenderState[RenderState["Rendered"]=30]="Rendered"})(RenderState=feint.RenderState||(feint.RenderState={}));var Nameable=function(){function Nameable(){this._name="untitle"}Object.defineProperty(Nameable.prototype,"Name",{get:function(){return this._name},set:function(name){this._name=name},enumerable:true,configurable:true});return Nameable}();feint.Nameable=Nameable;var Renderable=function(_super){__extends(Renderable,_super);function Renderable(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this._state=RenderState.NoRender;return _this}Object.defineProperty(Renderable.prototype,"State",{get:function(){return this._state},set:function(state){this._state=state},enumerable:true,configurable:true});return Renderable}(Nameable);feint.Renderable=Renderable})(feint||(feint={}));"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var feint;(function(feint){var GameObject=function(_super){__extends(GameObject,_super);function GameObject(name,bounding){var _this=_super.call(this)||this;_this._layer=1;_this._keyDownEvent=function(){};_this._keyUpEvent=function(){};_this._keyDownEventMap=[];_this._keyUpEventMap=[];_this._mouseDownEvent=function(){};_this._position=new feint.Position(bounding.X,bounding.Y);_this._size=new feint.Size(bounding.Width,bounding.Height);_this._bounding=bounding;_this.Name=name;return _this}Object.defineProperty(GameObject.prototype,"Position",{get:function(){return this._position},set:function(position){this._position=position;this._bounding.X=position.X;this._bounding.Y=position.Y},enumerable:true,configurable:true});Object.defineProperty(GameObject.prototype,"Bounding",{get:function(){return this._bounding},enumerable:true,configurable:true});GameObject.prototype.onKeyDown=function(keyCode,event){this._keyDownEventMap.push({keyCode:keyCode,event:event})};GameObject.prototype.onKeyUp=function(keyCode,event){this._keyUpEventMap.push({keyCode:keyCode,event:event})};GameObject.prototype.onMouseDown=function(event){this._mouseDownEvent=event};GameObject.prototype.mouseDown=function(){this._mouseDownEvent(this)};GameObject.prototype.getKeyDownEvent=function(keyCode){var event=function(){};this._keyDownEventMap.forEach(function(obj){if(obj.keyCode==keyCode){event=obj.event}});return event};GameObject.prototype.getKeyUpEvent=function(keyCode){var event=function(){};this._keyUpEventMap.forEach(function(obj){if(obj.keyCode==keyCode){event=obj.event}});return event};return GameObject}(feint.Renderable);feint.GameObject=GameObject;var BaseShape=function(_super){__extends(BaseShape,_super);function BaseShape(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this._fillColor="#ccc";return _this}Object.defineProperty(BaseShape.prototype,"FillColor",{get:function(){return this._fillColor},set:function(color){this._fillColor=color},enumerable:true,configurable:true});BaseShape.prototype.draw=function(canvas){};return BaseShape}(GameObject);feint.BaseShape=BaseShape;var Rectangle=function(_super){__extends(Rectangle,_super);function Rectangle(){return _super!==null&&_super.apply(this,arguments)||this}Rectangle.prototype.draw=function(canvas){canvas.FillStyle=this.FillColor;canvas.fillRect(this.Bounding)};return Rectangle}(BaseShape);feint.Rectangle=Rectangle})(feint||(feint={}));"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var feint;(function(feint){var Resource=function(_super){__extends(Resource,_super);function Resource(){return _super!==null&&_super.apply(this,arguments)||this}return Resource}(feint.Renderable);feint.Resource=Resource;var ResourceManager=function(){function ResourceManager(){this._resourceMap=new feint.Map}ResourceManager.prototype.save=function(resource){this._resourceMap.put(resource.Name,resource)};ResourceManager.prototype.find=function(name){return this._resourceMap.get(name)};return ResourceManager}();feint.ResourceManager=ResourceManager;var ImageResource=function(_super){__extends(ImageResource,_super);function ImageResource(name,src,size){var _this=_super.call(this)||this;_this.Name=name;var canvasEle=document.createElement("canvas");_this._canvas=new feint.Canvas(canvasEle);_this._canvas.resize(size);_this._canvas.drawImage(src,size,_this);return _this}Object.defineProperty(ImageResource.prototype,"Canvas",{get:function(){return this._canvas},enumerable:true,configurable:true});return ImageResource}(Resource);feint.ImageResource=ImageResource})(feint||(feint={}));"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var feint;(function(feint){var Scene=function(_super){__extends(Scene,_super);function Scene(canvas){var _this=_super.call(this)||this;_this._update=function(){};_this._resize=function(size){};_this._gameobjects=[];_this._gameObjectMap=new feint.Map;_this._render=new feint.Render(_this);_this._backGround="";_this._resourceManager=new feint.ResourceManager;_this._width=document.documentElement.clientWidth;_this._height=document.documentElement.clientHeight;_this._canvas=canvas;_this._canvas.resize(_this.Size);return _this}Object.defineProperty(Scene.prototype,"ResourceManager",{get:function(){return this._resourceManager},enumerable:true,configurable:true});Object.defineProperty(Scene.prototype,"BackGround",{get:function(){return this._backGround},set:function(background){this._backGround=background},enumerable:true,configurable:true});Object.defineProperty(Scene.prototype,"GameObjects",{get:function(){return this._gameobjects},enumerable:true,configurable:true});Object.defineProperty(Scene.prototype,"Canvas",{get:function(){return this._canvas},enumerable:true,configurable:true});Object.defineProperty(Scene.prototype,"Size",{get:function(){return new feint.Size(this._width,this._height)},set:function(size){this._width=size.Width;this._height=size.Height},enumerable:true,configurable:true});Scene.prototype.resize=function(size){this._width=size.Width;this._height=size.Height;this._canvas.resize(size)};Scene.prototype.addGameObject=function(gameObject){this._gameobjects.push(gameObject);this._gameObjectMap.put(gameObject.Name,gameObject)};Scene.prototype.removeGameObject=function(gameObject){this._gameobjects.splice(this._gameobjects.indexOf(gameObject),1)};Scene.prototype.clearGameObjects=function(){this._gameobjects=[];this._gameObjectMap=new feint.Map};Scene.prototype.find=function(name){if(this._gameObjectMap.get(name)!=null)return this._gameObjectMap.get(name);else return null};Scene.prototype.onUpdate=function(event){this._update=event};Scene.prototype.onResize=function(event){this._resize=event};Scene.prototype.run=function(){var _this=this;this.beforeStart();setInterval(function(){_this._resize(new feint.Size(document.documentElement.clientWidth,document.documentElement.clientHeight));_this._update();_this._render.render()},100)};Scene.prototype.beforeStart=function(){var _this=this;this._canvas.MouseDownEvent=function(event){var clickPos=new feint.Position(event.offsetX,event.offsetY);_this._gameobjects.forEach(function(gameobject){if(feint.isInArea(clickPos,gameobject.Bounding)){gameobject.mouseDown()}})};this._canvas.openListener()};Scene.prototype.loadResource=function(){};Scene.prototype.preview=function(){this._render.render()};return Scene}(feint.Renderable);feint.Scene=Scene})(feint||(feint={}));